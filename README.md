# pr-reviewer-assigment-service
```
Киндаров Ибрагим Муслимович
kindarov04@gmail.com
tg: @ibrakadabrs
```

Сервис автоматического назначения ревьюверов на Pull Request’ы.
Реализован на Go в соответствии с OpenAPI-спецификацией (`docs/openapi.yml`).
Поднимается командой:

```
docker-compose up --build
```

После запуска сервис доступен по адресу:

* API: [http://localhost:8080](http://localhost:8080)
* Swagger UI: [http://localhost:8080/swagger](http://localhost:8080/swagger)
* Healthcheck: [http://localhost:8080/health](http://localhost:8080/health)

Порт сервиса, параметры подключения к PostgreSQL и окружение задаются в `docker-compose.yml` через локальные переменные (`environment:`).


## Функциональность

### Управление командами

* Создание команды с пользователями — `/team/add`
* Получение команды — `/team/get`

### Управление пользователями

* Изменение активности пользователя — `/users/setIsActive`
* Получение списка PR, где пользователь является ревьювером — `/users/getReview`

### Управление Pull Request’ами

* Создание PR и автоматическое назначение 0–2 активных ревьюверов — `/pullRequest/create`
* Идемпотентный merge — `/pullRequest/merge`
* Переназначение ревьювера — `/pullRequest/reassign`

### Логика, соответствующая заданию

* Автор PR никогда не назначается ревьювером
* Неактивные пользователи не назначаются
* После статуса MERGED список ревьюверов изменять нельзя
* Переназначение выбирает случайного активного участника команды заменяемого ревьювера
* Если доступных кандидатов меньше двух, назначается 0 или 1 ревьювер


## Архитектура (Clean Architecture)

Проект разделён на независимые слои:

```
/cmd                  – точка входа, инициализация сервера
/internal
    /api              – HTTP API слой: хендлеры, DTO, роутер
    /application      – бизнес-логика (services), не зависит от transport/db
        service
        repository     – интерфейсы репозиториев
    /domain           – предметные сущности и доменные ошибки
    /infrastructure   – конкретные реализации репозиториев (Postgres)
/migrations           – SQL миграции для базы данных
```


## Работа с базой данных

Используется PostgreSQL.
Миграции находятся в каталоге `migrations` и применяются автоматически при запуске:

```
docker-compose up
```

Настройки подключения (хост, порт, пользователь, пароль, имя БД) задаются в `docker-compose.yml` в секции `environment:`.


```
go run ./cmd/main.go
```

---

## Swagger UI

Swagger UI встроен в сервис и отображается по адресу:

```
http://localhost:8080/swagger
```

UI использует файл `docs/openapi.yml`.



## Допущения

1. Пользователь всегда относится к команде (требование OpenAPI).
2. Эндпоинт `/team/add` также создаёт или обновляет пользователей.
3. Список ревьюверов хранится в PostgreSQL как `TEXT[]`.
4. Алгоритм выбора ревьюверов — случайный из активных кандидатов.
5. Операция merge полностью идемпотентна.
6. Переназначение генерирует нового ревьювера только из команды заменяемого.
